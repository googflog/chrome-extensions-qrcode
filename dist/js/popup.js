"use strict";$(function(){function i(t){$("#qr").html(""),$("#qr").qrcode(t);var e,o,a,i,n,r,l,s=t.match(/^https?:\/{2,}(.*?)(?:\/|\?|#|$)/)[1],c=(e=new Date,o=e.getFullYear().toString(),a=(e.getMonth()+1).toString(),i=e.getDate().toString(),n=e.getHours().toString(),r=e.getMinutes().toString(),l=e.getSeconds().toString(),o+a+i+n+r+l),d=$("canvas")[0].toDataURL();$(".download").attr("href",d),$(".download").attr("download","qr-"+c+"-"+s+".png")}function l(){var t=localStorage.getItem("qrcodeextensions12345");if(t){var e=JSON.parse(t);return console.log(e),e}return!1}var n,t,r="",s="";chrome.storage.sync.get({bitly_access_token:"",bitly_domain:"bit.ly"},function(t){""!=t.bitly_access_token.length?(console.log("[ Load ]",t.bitly_access_token),r=t.bitly_access_token):(console.log("[ NoLoad ]"),r="ebd7a67d641fb54e4c84e2571369de37bbb79a12"),s=t.bitly_domain}),chrome.tabs?chrome.tabs.getSelected(null,function(t){i(t.url),$("textarea").val(decodeURI(t.url)),function(t,e){var o=l(),a=[];console.log("historyListObj",o);var i=!1;if(o)for(var n in o)a.push({url:o[n].url,title:o[n].title,date:o[n].date}),t==o[n].url&&(i=!0);i||a.push({url:t,title:e,date:new Date}),30<a.length&&a.shift();var r=JSON.stringify(a);localStorage.setItem("qrcodeextensions12345",r)}($("textarea").val(),t.title)}):($("#qr").qrcode(window.location.href),$("textarea").val(decodeURI(window.location.href))),$(document).on("click","#qr",function(){$(this).hasClass("expansion")?$(this).removeClass("expansion"):$(this).addClass("expansion")}),$("textarea").on("keydown",function(){clearTimeout(t),t=setTimeout(function(){i(encodeURI($("textarea").val())),$(".copy").show()},300)}),$("textarea").on("click",function(){$(this).addClass("click-open")}),$(".undo").on("click",function(){$("textarea").val(n),i(encodeURI($("textarea").val())),$(".bitly").show(),$(".undo").hide(),$(".url").removeClass("bit-mode"),$(".copy").hide()}),$(".copy").on("click",function(){$("textarea").focus(),$("textarea").select(),document.execCommand("copy")?console.log("コピーが成功しました！"):console.log("コピーが失敗しました!")}),$(".bitly").on("click",function(){var t,e,o,a;n=$("textarea").val(),(t=n,e=encodeURIComponent(t),o="https://api-ssl.bitly.com/v3/shorten?access_token="+r+"&longUrl="+e+"&domain="+s,a=new $.Deferred,$.ajax({type:"get",url:o,dataType:"jsonp",processData:!1,contentType:!1,success:a.resolve,error:a.reject}),a.promise()).done(function(t){var e,o;t.data.url?($(".bitly").hide(),$(".undo").show(),$(".copy").show(),$(".url").addClass("bit-mode"),$("textarea").val(t.data.url),i(t.data.url),$("textarea")[0].select()):(o=t.status_txt,e=o.replace(/_/g," "),$(".alert").html(e).show(),setTimeout(function(){$(".alert").slideUp(400)},3e3))})}),$(".history").on("click",function(){!function(){$(".history-list").show(),$(".back").show(),$(".history-clear").show(),$(".history").hide(),$(".qr").hide(),$(".textarea").hide(),$(".bitly").hide(),$(".copy").hide(),$(".undo").hide(),$(".option").show();var t=l();if(t.reverse(),t)for(var e in $(".history-list ul").html(""),t)$(".history-list ul").append('<li data-obj="'+t[e].url+'"><dl><dt>'+t[e].title+"</dt><dd>"+t[e].url+"</dd></dl></li>")}()}),$(".back").on("click",function(){$(".history-list").hide(),$(".back").hide(),$(".history-clear").hide(),$(".history").show(),$(".qr").show(),$(".textarea").show(),$(".bitly").show(),$(".option").hide(),$("textarea").val()}),$(document).on("click",".history-list li",function(){$(".history-list").hide(),$(".back").hide(),$(".history-clear").hide(),$(".history").show(),$(".qr").show(),$(".textarea").show(),$(".bitly").show(),$(".option").hide();var t=$(this).data("obj");$("textarea").val(t),i(encodeURI($("textarea").val()))}),$(".option").on("click",function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options.html"))});new PerfectScrollbar(".history-list",{})});