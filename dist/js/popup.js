"use strict";$(function(){function a(t){$("#qr").html(""),$("#qr").qrcode(t);var e,o,n,a,i,r,l,s=t.match(/^https?:\/{2,}(.*?)(?:\/|\?|#|$)/)[1],c=(e=new Date,o=e.getFullYear().toString(),n=(e.getMonth()+1).toString(),a=e.getDate().toString(),i=e.getHours().toString(),r=e.getMinutes().toString(),l=e.getSeconds().toString(),o+n+a+i+r+l),d=$("canvas")[0].toDataURL();$(".download").attr("href",d),$(".download").attr("download","qr-"+c+"-"+s+".png")}function l(){var t=localStorage.getItem("qrcodeextensions12345");if(t){var e=JSON.parse(t);return console.log(e),e}return!1}var i,t,r="",s="";chrome.storage.sync.get({bitly_access_token:"",bitly_domain:"bit.ly"},function(t){""!=t.bitly_access_token.length?(console.log("[ Load ]",t.bitly_access_token),r=t.bitly_access_token):(console.log("[ NoLoad ]"),r="ebd7a67d641fb54e4c84e2571369de37bbb79a12"),s=t.bitly_domain}),chrome.tabs?chrome.tabs.getSelected(null,function(t){a(t.url),$("textarea").val(decodeURI(t.url)),function(t,e){var o=l(),n=[];console.log("historyListObj",o);var a=!1;if(o)for(var i in o)n.push({url:o[i].url,title:o[i].title,date:o[i].date}),t==o[i].url&&(a=!0);a||n.push({url:t,title:e,date:new Date}),30<n.length&&n.shift();var r=JSON.stringify(n);localStorage.setItem("qrcodeextensions12345",r)}($("textarea").val(),t.title)}):($("#qr").qrcode(window.location.href),$("textarea").val(decodeURI(window.location.href))),$(document).on("click","#qr",function(){$(".contets").hasClass("expansion")?$(".contets").removeClass("expansion"):$(".contets").addClass("expansion")}),$("textarea").on("keydown",function(){clearTimeout(t),t=setTimeout(function(){a(encodeURI($("textarea").val())),$(".copy").show()},300)}),$("textarea").on("click",function(){$(this).addClass("click-open")}),$(".undo").on("click",function(){$("textarea").val(i),a(encodeURI($("textarea").val())),$(".bitly").show(),$(".undo").hide(),$(".url").removeClass("bit-mode"),$(".copy").hide()}),$(".copy").on("click",function(){$("textarea").focus(),$("textarea").select(),document.execCommand("copy")?console.log("コピーが成功しました！"):console.log("コピーが失敗しました!")}),$(".bitly").on("click",function(){var t,e,o,n;i=$("textarea").val(),(t=i,e=encodeURIComponent(t),o="https://api-ssl.bitly.com/v3/shorten?access_token="+r+"&longUrl="+e+"&domain="+s,n=new $.Deferred,$.ajax({type:"get",url:o,dataType:"jsonp",processData:!1,contentType:!1,success:n.resolve,error:n.reject}),n.promise()).done(function(t){var e,o;t.data.url?($(".bitly").hide(),$(".undo").show(),$(".copy").show(),$(".url").addClass("bit-mode"),$("textarea").val(t.data.url),a(t.data.url),$("textarea")[0].select()):(o=t.status_txt,e=o.replace(/_/g," "),$(".alert").html(e).show(),setTimeout(function(){$(".alert").slideUp(400)},3e3))})}),$(".history").on("click",function(){!function(){$(".contets_inline").addClass("history"),$(".history-list").show(),$(".back").show(),$(".history-clear").show(),$(".option").show();var t=l();if(t.reverse(),t)for(var e in $(".history-list ul").html(""),t)$(".history-list ul").append('<li data-obj="'+t[e].url+'"><dl><dt>'+t[e].title+"</dt><dd>"+t[e].url+"</dd></dl></li>")}()}),$(".back").on("click",function(){$("textarea").val(),$(".contets_inline").removeClass("history")}),$(document).on("click",".history-list li",function(){var t=$(this).data("obj");$("textarea").val(t),a(encodeURI($("textarea").val())),$(".contets_inline").removeClass("history")}),$(".option").on("click",function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options.html"))});new PerfectScrollbar(".history-list",{})});