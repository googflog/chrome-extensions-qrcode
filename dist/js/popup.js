"use strict";$(function(){function t(t){$("#qr").html(""),$("#qr").qrcode(t);var o=t.match(/^https?:\/{2,}(.*?)(?:\/|\?|#|$)/)[1],n=e(),s=$("canvas")[0].toDataURL();$(".download").attr("href",s),$(".download").attr("download","qr-"+n+"-"+o+".png")}function e(){var t=new Date;return t.getFullYear().toString()+(t.getMonth()+1).toString()+t.getDate().toString()+t.getHours().toString()+t.getMinutes().toString()+t.getSeconds().toString()}function o(){$("textarea").focus(),$("textarea").select(),document.execCommand("copy")?console.log("コピーが成功しました！"):console.log("コピーが失敗しました!")}function n(t){var e=encodeURIComponent(t),o="https://api-ssl.bitly.com/v3/shorten?access_token="+l+"&longUrl="+e+"&domain="+r,n=new $.Deferred;return $.ajax({type:"get",url:o,dataType:"jsonp",processData:!1,contentType:!1,success:n.resolve,error:n.reject}),n.promise()}function s(){$(".history-list").show(),$(".back").show(),$(".history-clear").show(),$(".history").hide(),$(".qr").hide(),$(".textarea").hide(),$(".bitly").hide(),$(".copy").hide(),$(".undo").hide();var t=a();if(t.reverse(),t){$(".history-list ul").html("");for(var e in t)$(".history-list ul").append('<li data-obj="'+t[e]+'">'+t[e]+"</li>")}}function a(){var t=localStorage.getItem("qrcodeextensions12345");if(t){var e=JSON.parse(t);return console.log(e),e}return!1}function c(t){var e=a(),o=[];console.log("historyListObj",e);var n=!1;if(e){console.log("historyListObj",e);for(var s in e)o.push(e[s]),t==e[s]&&(n=!0)}n||o.push(t),30<o.length&&o.shift();var c=JSON.stringify(o);localStorage.setItem("qrcodeextensions12345",c)}var i,l="",r="";chrome.storage.sync.get({bitly_access_token:"",bitly_domain:"bit.ly"},function(t){""!=t.bitly_access_token.length?(console.log("[ Load ]",t.bitly_access_token),l=t.bitly_access_token):(console.log("[ NoLoad ]"),l="ebd7a67d641fb54e4c84e2571369de37bbb79a12"),r=t.bitly_domain}),chrome.tabs?chrome.tabs.getSelected(null,function(e){t(e.url),$("textarea").val(decodeURI(e.url)),c($("textarea").val())}):($("#qr").qrcode(window.location.href),$("textarea").val(decodeURI(window.location.href))),$(document).on("click","#qr",function(){$(this).hasClass("expansion")?$(this).removeClass("expansion"):$(this).addClass("expansion")});var h;$("textarea").on("keydown",function(){clearTimeout(h),h=setTimeout(function(){t(encodeURI($("textarea").val())),$(".copy").show()},300)}),$("textarea").on("click",function(){$(this).addClass("click-open")}),$(".undo").on("click",function(){$("textarea").val(i),t(encodeURI($("textarea").val())),$(".bitly").show(),$(".undo").hide(),$(".copy").hide(),$(".url").removeClass("bit-mode")}),$(".copy").on("click",function(){o()}),$(".bitly").on("click",function(){i=$("textarea").val(),n(i).done(function(e){e.data.url&&($(".bitly").hide(),$(".undo").show(),$(".copy").show(),$(".url").addClass("bit-mode"),$("textarea").val(e.data.url),t(e.data.url),$("textarea")[0].select())})}),$(".history").on("click",function(){s()}),$(".back").on("click",function(){$(".history-list").hide(),$(".back").hide(),$(".history-clear").hide(),$(".history").show(),$(".qr").show(),$(".textarea").show(),$(".bitly").show()}),$(document).on("click",".history-list li",function(){$(".history-list").hide(),$(".back").hide(),$(".history-clear").hide(),$(".history").show(),$(".qr").show(),$(".textarea").show(),$(".bitly").show(),$(".copy").show();var e=$(this).data("obj");$("textarea").val(e),t(encodeURI($("textarea").val()))}),$(".history-clear").on("click",function(){localStorage.removeItem("qrcodeextensions12345"),$(".history-list ul").html("")})});